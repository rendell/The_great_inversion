<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aruba's Demographic Transformation: 1991-2023</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.27.0/plotly.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: white;
        }
        #chart-container {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
        }
        #pyramid {
            width: 100%;
            height: 600px;
        }
        .controls {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
        }
        .control-btn {
            background-color: #2E86AB;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        .control-btn:hover {
            background-color: #1a5f7a;
        }
        .control-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .speed-control {
            margin-top: 10px;
        }
        .speed-label {
            margin: 0 10px;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <div id="chart-container">
        <div id="pyramid"></div>
        <div class="controls">
            <button id="playBtn" class="control-btn">⏸ Pause</button>
            <button id="resetBtn" class="control-btn">↺ Reset</button>
            <div class="speed-control">
                <span class="speed-label">Speed:</span>
                <button id="slowBtn" class="control-btn">Slow</button>
                <button id="normalBtn" class="control-btn">Normal</button>
                <button id="fastBtn" class="control-btn">Fast</button>
            </div>
        </div>
    </div>

    <script>
        // Version: Iteration 5
        // Wait for Plotly to load with timeout
        function checkPlotlyAndInit() {
            if (typeof Plotly !== 'undefined') {
                console.log('Plotly loaded successfully');
                initializeVisualization();
            } else {
                console.error('Plotly not loaded');
                setTimeout(checkPlotlyAndInit, 100);
            }
        }
        
        window.addEventListener('load', function() {
            setTimeout(checkPlotlyAndInit, 100);
        });

        function initializeVisualization() {
        // Data structure: years and age groups with male/female populations
        // Generate array of all years from 1991 to 2025
        const years = [2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025];
        
        const ageGroups = ['0-4', '5-9', '10-14', '15-19', '20-24', '25-29', '30-34', 
                          '35-39', '40-44', '45-49', '50-54', '55-59', '60-64', 
                          '65-69', '70-74', '75-79', '80+'];
const demographicData = {
    2000: {
        male: [3625, 3634, 3399, 3087, 2493, 3040, 3798, 4369, 4005, 3291, 2583, 1949, 1579, 1154, 755, 469, 456],
        female: [3488, 3543, 3383, 3111, 2624, 3334, 4036, 4744, 4508, 3711, 2881, 2183, 1911, 1485, 966, 589, 855]
    },
    2001: {
        male: [3499, 3617, 3422, 3100, 2492, 2906, 3735, 4233, 4195, 3401, 2709, 2023, 1615, 1220, 832, 481, 436],
        female: [3404, 3547, 3413, 3133, 2553, 3192, 4148, 4674, 4622, 3883, 2994, 2325, 1909, 1592, 1038, 636, 864]
    },
    2002: {
        male: [3321, 3638, 3493, 3070, 2376, 2775, 3664, 4134, 4275, 3522, 2848, 2153, 1664, 1247, 921, 464, 466],
        female: [3290, 3516, 3476, 3126, 2407, 3060, 4140, 4575, 4747, 4064, 3175, 2444, 1940, 1658, 1153, 627, 882]
    },
    2003: {
        male: [3330, 3647, 3592, 3135, 2405, 2663, 3649, 4033, 4391, 3693, 3037, 2238, 1700, 1314, 927, 506, 500],
        female: [3225, 3515, 3583, 3175, 2458, 3069, 4051, 4563, 4833, 4288, 3333, 2600, 1963, 1718, 1219, 696, 897]
    },
    2004: {
        male: [3316, 3653, 3637, 3290, 2484, 2671, 3607, 4034, 4502, 3873, 3172, 2372, 1770, 1384, 973, 550, 514],
        female: [3207, 3546, 3606, 3346, 2484, 3194, 4029, 4481, 5045, 4479, 3587, 2709, 2054, 1770, 1300, 777, 916]
    },
    2005: {
        male: [3268, 3706, 3780, 3454, 2551, 2678, 3515, 4046, 4572, 4103, 3296, 2546, 1880, 1451, 1010, 611, 526],
        female: [3141, 3603, 3696, 3451, 2626, 3235, 3979, 4526, 5101, 4713, 3814, 2893, 2158, 1836, 1374, 859, 946]
    },
    2006: {
        male: [3259, 3625, 3781, 3504, 2607, 2676, 3340, 4001, 4444, 4316, 3416, 2692, 1980, 1483, 1061, 666, 539],
        female: [3192, 3541, 3698, 3500, 2679, 3107, 3787, 4551, 5023, 4820, 4004, 3057, 2316, 1839, 1489, 913, 968]
    },
    2007: {
        male: [3335, 3464, 3799, 3587, 2596, 2578, 3206, 3937, 4314, 4397, 3533, 2833, 2095, 1552, 1081, 730, 561],
        female: [3192, 3498, 3687, 3532, 2680, 2981, 3679, 4524, 4838, 4932, 4180, 3226, 2450, 1864, 1547, 1041, 984]
    },
    2008: {
        male: [3329, 3467, 3766, 3602, 2633, 2573, 3128, 3939, 4241, 4504, 3716, 3001, 2180, 1620, 1155, 723, 611],
        female: [3242, 3364, 3667, 3563, 2666, 2963, 3585, 4388, 4747, 5019, 4387, 3361, 2602, 1900, 1606, 1087, 1081]
    },
    2009: {
        male: [3367, 3358, 3684, 3588, 2677, 2570, 3063, 3831, 4149, 4565, 3858, 3137, 2303, 1654, 1192, 773, 628],
        female: [3213, 3277, 3641, 3521, 2687, 2816, 3624, 4281, 4617, 5086, 4520, 3562, 2677, 1953, 1649, 1135, 1139]
    },
    2010: {
        male: [3357, 3583, 3803, 3795, 2763, 2571, 2901, 3472, 3852, 4315, 3927, 3211, 2382, 1735, 1255, 813, 672],
        female: [3189, 3446, 3702, 3563, 2605, 2930, 3511, 3922, 4455, 4880, 4548, 3738, 2817, 2052, 1688, 1188, 1237]
    },
    2011: {
        male: [3299, 3541, 3810, 3846, 2832, 2609, 2962, 3345, 3904, 4206, 4098, 3318, 2515, 1800, 1321, 832, 730],
        female: [3117, 3432, 3737, 3664, 2657, 2946, 3544, 3821, 4575, 4843, 4674, 3904, 2959, 2210, 1685, 1286, 1285]
    },
    2012: {
        male: [3249, 3603, 3728, 3873, 2967, 2677, 2977, 3247, 3912, 4109, 4214, 3441, 2715, 1893, 1387, 848, 807],
        female: [3178, 3372, 3740, 3717, 2771, 2928, 3537, 3809, 4577, 4813, 4805, 4067, 3153, 2363, 1714, 1346, 1372]
    },
    2013: {
        male: [3283, 3592, 3708, 3795, 3116, 2751, 2978, 3219, 3864, 3998, 4301, 3595, 2877, 1980, 1431, 917, 840],
        female: [3242, 3369, 3650, 3692, 2950, 2959, 3550, 3876, 4497, 4756, 4914, 4272, 3291, 2542, 1748, 1386, 1505]
    },
    2014: {
        male: [3378, 3550, 3629, 3763, 3141, 2830, 3000, 3218, 3758, 3934, 4326, 3721, 2996, 2097, 1434, 984, 881],
        female: [3262, 3354, 3501, 3650, 2950, 3026, 3502, 3894, 4381, 4641, 5024, 4393, 3486, 2610, 1838, 1434, 1590]
    },
    2015: {
        male: [3442, 3477, 3585, 3697, 3204, 2993, 3050, 3290, 3664, 3935, 4343, 3845, 3099, 2226, 1508, 1036, 913],
        female: [3261, 3300, 3485, 3645, 3060, 3068, 3583, 3953, 4231, 4668, 4970, 4559, 3697, 2740, 1941, 1498, 1667]
    },
    2016: {
        male: [3448, 3398, 3568, 3623, 3200, 3080, 3084, 3301, 3481, 3951, 4202, 4014, 3180, 2328, 1568, 1082, 959],
        female: [3243, 3252, 3471, 3571, 3033, 3057, 3537, 3910, 4038, 4721, 4882, 4632, 3853, 2855, 2063, 1491, 1740]
    },
    2017: {
        male: [3456, 3314, 3605, 3551, 3112, 3084, 3103, 3258, 3358, 3910, 4061, 4076, 3280, 2489, 1635, 1135, 973],
        female: [3166, 3285, 3395, 3496, 2969, 3147, 3457, 3854, 3963, 4621, 4788, 4704, 3939, 2980, 2179, 1493, 1813]
    },
    2018: {
        male: [3340, 3313, 3599, 3541, 3008, 3124, 3118, 3219, 3356, 3866, 3914, 4161, 3398, 2663, 1697, 1156, 1042],
        female: [3107, 3291, 3411, 3433, 2884, 3266, 3435, 3869, 3992, 4546, 4698, 4813, 4098, 3077, 2320, 1507, 1907]
    },
    2019: {
        male: [3216, 3375, 3533, 3462, 2943, 3072, 3176, 3208, 3350, 3766, 3858, 4205, 3485, 2783, 1801, 1149, 1139],
        female: [3013, 3296, 3392, 3341, 2787, 3189, 3482, 3805, 4031, 4419, 4592, 4936, 4207, 3245, 2396, 1573, 2028]
    },
    2020: {
        male: [2702, 3209, 3485, 3561, 2845, 2947, 3207, 3191, 3253, 3450, 3837, 4077, 3592, 2932, 2056, 1298, 1286],
        female: [2509, 3083, 3412, 3338, 2623, 3107, 3472, 3712, 4017, 4136, 4590, 4735, 4423, 3503, 2510, 1719, 2111]
    },
    2021: {
        male: [2606, 3140, 3344, 3541, 2728, 2942, 3147, 3222, 3314, 3349, 3763, 3958, 3774, 2975, 2169, 1345, 1345],
        female: [2406, 3006, 3343, 3265, 2560, 2991, 3441, 3718, 3970, 3981, 4603, 4705, 4504, 3648, 2635, 1842, 2184]
    },
    2022: {
        male: [2519, 3055, 3233, 3562, 2604, 2882, 3196, 3218, 3334, 3254, 3684, 3856, 3863, 3091, 2304, 1414, 1370],
        female: [2329, 2877, 3282, 3282, 2513, 2849, 3487, 3704, 3921, 3931, 4552, 4624, 4575, 3827, 2740, 1984, 2235]
    },
    2023: {
        male: [2442, 2947, 3207, 3499, 2677, 2809, 3249, 3297, 3335, 3213, 3623, 3786, 3911, 3195, 2432, 1494, 1444],
        female: [2241, 2753, 3241, 3315, 2550, 2765, 3543, 3751, 3940, 3960, 4476, 4589, 4625, 3973, 2859, 2090, 2344]
    },
    2024: {
        male: [2388, 2800, 3193, 3514, 2798, 2811, 3287, 3420, 3424, 3283, 3542, 3714, 3981, 3257, 2544, 1600, 1526],
        female: [2206, 2626, 3163, 3388, 2533, 2732, 3520, 3829, 3974, 4070, 4372, 4506, 4721, 4048, 3078, 2147, 2433]
    },
    2025: {
        male: [2374, 2777, 3193, 3505, 2846, 2830, 3290, 3461, 3444, 3321, 3526, 3740, 3974, 3284, 2572, 1634, 1544],
        female: [2200, 2598, 3151, 3411, 2572, 2761, 3537, 3840, 3990, 4107, 4333, 4535, 4694, 4085, 3116, 2166, 2472]
    }
};
            
        // Animation settings
        let currentYearIndex = 0;
        let isPlaying = true;
        let animationSpeed = 1500; // milliseconds between frames
        let animationInterval;

        // Color scheme
        const maleColor = '#2E86AB';
        const femaleColor = '#A23B72';

        function createPyramidFrame(year) {
            const data = demographicData[year];
            
            return [{
                type: 'bar',
                x: data.male.map(val => -val),
                y: ageGroups,
                orientation: 'h',
                name: 'Male',
                marker: {
                    color: maleColor
                },
                hovertemplate: 'Age: %{y}<br>Male: %{customdata:,}<extra></extra>',
                customdata: data.male
            }, {
                type: 'bar',
                x: data.female,
                y: ageGroups,
                orientation: 'h',
                name: 'Female',
                marker: {
                    color: femaleColor
                },
                hovertemplate: 'Age: %{y}<br>Female: %{x:,}<extra></extra>'
            }];
        }

        function getLayout(year) {
            return {
                title: {
                    text: `Aruba Population Structure: ${year}<br><sub>The Great Inversion in Motion</sub>`,
                    font: {
                        size: 20,
                        color: '#333'
                    }
                },
                barmode: 'overlay',
                bargap: 0.1,
                xaxis: {
                    title: 'Population',
                    tickformat: ',d',
                    tickmode: 'array',
                    tickvals: [-4500, -3000, -1500, 0, 1500, 3000, 4500],
                    ticktext: ['4,500', '3,000', '1,500', '0', '1,500', '3,000', '4,500'],
                    zeroline: true,
                    zerolinecolor: '#999',
                    zerolinewidth: 2
                },
                yaxis: {
                    title: 'Age Group'
                },
                showlegend: true,
                legend: {
                    x: 0.1,
                    y: 0.95,
                    bgcolor: 'rgba(255, 255, 255, 0.8)',
                    bordercolor: '#ccc',
                    borderwidth: 1
                },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                margin: {
                    l: 80,
                    r: 40,
                    t: 100,
                    b: 60
                }
            };
        }

        function updateChart() {
            const year = years[currentYearIndex];
            const data = createPyramidFrame(year);
            const layout = getLayout(year);
            
            Plotly.react('pyramid', data, layout, {
                displayModeBar: false,
                responsive: true
            });
        }

        function nextFrame() {
            currentYearIndex = (currentYearIndex + 1) % years.length;
            updateChart();
        }

        function startAnimation() {
            if (animationInterval) {
                clearInterval(animationInterval);
            }
            animationInterval = setInterval(nextFrame, animationSpeed);
            isPlaying = true;
            document.getElementById('playBtn').innerHTML = '⏸ Pause';
        }

        function stopAnimation() {
            if (animationInterval) {
                clearInterval(animationInterval);
                animationInterval = null;
            }
            isPlaying = false;
            document.getElementById('playBtn').innerHTML = '▶ Play';
        }

        function togglePlayPause() {
            if (isPlaying) {
                stopAnimation();
            } else {
                startAnimation();
            }
        }

        function resetAnimation() {
            currentYearIndex = 0;
            updateChart();
        }

        function setSpeed(speed) {
            const wasPlaying = isPlaying;
            stopAnimation();
            
            switch(speed) {
                case 'slow':
                    animationSpeed = 2500;
                    break;
                case 'normal':
                    animationSpeed = 1500;
                    break;
                case 'fast':
                    animationSpeed = 800;
                    break;
            }
            
            if (wasPlaying) {
                startAnimation();
            }
        }

        // Event listeners
        document.getElementById('playBtn').addEventListener('click', togglePlayPause);
        document.getElementById('resetBtn').addEventListener('click', resetAnimation);
        document.getElementById('slowBtn').addEventListener('click', () => setSpeed('slow'));
        document.getElementById('normalBtn').addEventListener('click', () => setSpeed('normal'));
        document.getElementById('fastBtn').addEventListener('click', () => setSpeed('fast'));

        // Initialize
        updateChart();
        startAnimation();

        // Handle window resize
        window.addEventListener('resize', updateChart);
        } // End of initializeVisualization function
    </script>
</body>
</html>
